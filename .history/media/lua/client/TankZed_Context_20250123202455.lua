--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]

require "TankZed_Util"
TankZedModII = TankZedModII or {}

function TankZedModII.getOutfit(num)
	if num == 0 or num == nil then
		num = tostring(ZombRand(1,3))
	end
	return 'Dreadnought'..tostring(num)
end

function TankZedModII.getTypeIcon(int)
	local ico = "media/ui/TankZed_Type"..tostring(int)..".png"
	return getTexture(ico)
end

function TankZedModII.Context(player, context, worldobjects)
	local pl = getSpecificPlayer(player)
	if not pl then return end
	local inv = pl:getInventory()
	local sq = clickedSquare
	local worldSquare = nil
	if (getCore():getDebug() or isAdmin()) then
		local Main = context:addOptionOnTop("TankZedII Debug:")
		Main.iconTexture = getTexture("media/ui/TankZed_Context2.png")
		local opt = ISContextMenu:getNew(context)
		context:addSubMenu(Main, opt)


		local sb = opt:addOptionOnTop("Population: ")
		sb.iconTexture = getTexture("media/ui/TankZedIcon_Green.png")
		local spwn = ISContextMenu:getNew(opt)
		opt:addSubMenu(sb, spwn)

		if sq then

			local int = 1
			local sIco = spwn:addOption("Spawn Dreadnought I", worldobjects, function()
				TankZedModII.doSpawn(sq, false, TankZedModII.getOutfit(int))
			end);
			sIco.iconTexture = TankZedModII.getTypeIcon(int)

			local int = 2
			local sIco = spwn:addOption("Spawn Dreadnought II", worldobjects, function()
				TankZedModII.doSpawn(sq, false, TankZedModII.getOutfit(int))
			end);
			sIco.iconTexture = TankZedModII.getTypeIcon(int)

			local int = 0
			local sIco = spwn:addOption("Spawn Random Dreadnought", worldobjects, function()
				TankZedModII.doSpawn(sq, false, TankZedModII.getOutfit(int))
			end);
			sIco.iconTexture = TankZedModII.getTypeIcon(int)


			local sIco = spwn:addOption("Spawn Random Dreadnought  X5" , worldobjects, function()
				for i = 1, 5  do
					TankZedModII.doSpawn(sq, false, TankZedModII.getOutfit(int))
				end
			end);
			sIco.iconTexture = TankZedModII.getTypeIcon(int)
			local sIco = spwn:addOption("Spawn Dreadnought  X15" , worldobjects, function()
				for i = 1, 15  do
					TankZedModII.doSpawn(sq, false, TankZedModII.getOutfit(int))
				end
			end);
			sIco.iconTexture = TankZedModII.getTypeIcon(int)
		end


		local sIco2 = spwn:addOption("Kill Nearby Dreadnought", worldobjects, function()
			local rad = 15
			local count = 0
			local cell = pl:getCell()
			local x, y, z = pl:getX(), pl:getY(), pl:getZ()
			for xDelta = -rad, rad do
				for yDelta = -rad, rad do
					local sq = cell:getGridSquare(x + xDelta, y + yDelta, z)
					if sq then
						local zed = sq:getZombie()
						if zed and TankZedModII.isTankZed(zed) then
							count = count + 1
							zed:setAvoidDamage(false)
							zed:setImmortalTutorialZombie(false)
							zed:changeState(ZombieOnGroundState.instance())
							zed:setAttackedBy(getCell():getFakeZombieForHit())
							zed:becomeCorpse()
						end
					end
				end
			end
			if count > 1 then
				print('killed '..tostring(count)..' Dreadnoughts')
			else
				print('killed '..tostring(count)..' Dreadnought')
			end
		end)

		sIco2.iconTexture = getTexture("media/ui/TankZedIcon_Red.png")

		local sIco2 = spwn:addOption("Kill Non Dreadnought Zed", worldobjects, function()
			local rad = 15
			local count = 0
			local cell = pl:getCell()
			local x, y, z = pl:getX(), pl:getY(), pl:getZ()
			for xDelta = -rad, rad do
				for yDelta = -rad, rad do
					local sq = cell:getGridSquare(x + xDelta, y + yDelta, z)
					if sq then
						local zed = sq:getZombie()
						if zed and not TankZedModII.isTankZed(zed) then
							count = count + 1
							--TankZedModII.doKill(zed)
							zed:changeState(ZombieOnGroundState.instance())
							zed:setAttackedBy(getCell():getFakeZombieForHit())
							zed:becomeCorpse()
						end
					end
				end
			end
			if count > 1 then
				print('killed '..tostring(count)..' Zeds')
			else
				print('killed '..tostring(count)..' Zed')
			end
		end)
		sIco2.iconTexture = getTexture("media/ui/TankZedIcon_Red.png")





-----------------------    wear*        ---------------------------
		if not TankZedModII.isWearingTankZedII(pl) then

			local ss = opt:addOption("Wear TankZed I", worldobjects, function()
				TankZedModII.wearTankZedII(pl, 1)
			end);

			local ss = opt:addOption("Wear TankZed II", worldobjects, function()
				TankZedModII.wearTankZedII(pl, 2)
			end);

			local tip = ISWorldObjectContextMenu.addToolTip()
			tip.description = tostring(TankZedModII.isWearingTankZedII(pl))
			ss.toolTip = tip
			ss.iconTexture = getTexture("media/ui/TankZed_Context4.png")
		else
			local ss = opt:addOption("Wear TankZedII");
			ss.notAvailable = true
			ss.iconTexture = getTexture("media/ui/TankZed_Context1.png")


			local ss3 = opt:addOption("Remove TankZedII Outfit", worldobjects, function()
				TankZedModII.clearTankZedIISkin(pl)
			end)

			ss3.iconTexture = getTexture("media/ui/TankZed_Context1.png")
			local tip = ISWorldObjectContextMenu.addToolTip()
			tip.description = 'removes TankZedII skin'
			ss3.toolTip = tip

		end



-----------------------            ---------------------------

		if sq then
			local zed = sq:getZombie()
			-----------------------

			if zed then
				local sbd = opt:addOptionOnTop("Set Zed")
				sbd.iconTexture = getTexture("media/ui/TankZedIcon_Yellow.png")
				local stz = ISContextMenu:getNew(opt)
				opt:addSubMenu(sbd, stz)

				if TankZedModII.isTankZed(zed) then
					local w = stz:addOption("Walk Type: "..tostring(zed:getVariableString("zombieWalkType")))
				end


				if not TankZedModII.isTankZed(zed) then
					local d = stz:addOption("Set Dreadnought", worldobjects, function()
						if sq:getFloor() then
							sq:getFloor():setHighlighted(true)
						end

						TankZedModII.setTankZedII(zed)
					end)
					d.iconTexture = getTexture("media/ui/TankZedIcon_Red.png")
				else
					local d = stz:addOption("Dreadnought")
					d.notAvailable = true
					d.iconTexture = getTexture("media/ui/TankZedIcon_Gray.png")
					stz:setOptionChecked(d,   TankZedModII.isTankZed(zed))
				end

			end
		end
		-----------------------

	end
end
Events.OnFillWorldObjectContextMenu.Remove(TankZedModII.Context)

Events.OnFillWorldObjectContextMenu.Add(TankZedModII.Context)
